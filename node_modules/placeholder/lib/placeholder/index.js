var placeholder = module.exports = {
    
};

var _data = {};

placeholder.install = function(options) {
    if (options.jade) {
        options.jade.filters.placeholder = jadefilter;
    }
    if (options.express) {
        var createServer = options.express.createServer;
        options.express.createServer = function() {
            var app = createServer.apply(options.express, arguments);
            app.helpers({
                placeholder: expresshelper
            });
            return app;
        };
    }
};

// define jade filter
var jadefilter = placeholder.jadefilter = function(block, compiler, attrs) {
    var jade = require('jade');
    attrs = attrs || {};
    var name;
    
    if (attrs.define) {
        name = attrs.define;
        name = name.substr(1, name.length-2); // remove leading and trailing quotes
        _data[name] = new jade.Compiler(block, compiler.options).compile();
    } else if (attrs.render) {
        name = attrs.render;
        name = name.substr(1, name.length-2); // remove leading and trailing quotes
        return _data[name];
    }
    return '';
};

// define app helper
var expresshelper = placeholder.expresshelper = function(name) {
    return _data[name];
};
expresshelper.define = function(name, value) {
    _data[name] = value;
};